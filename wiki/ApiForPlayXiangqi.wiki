#summary The public API supported by PlayXiangqi.com server
#labels Phase-Design

<wiki:toc max_depth="1" />

= Introduction =

This page describes the public API supported by [http://www.playxiangqi.com PlayXiangqi server]


= Overview =

A Request (to the server) or a Response (from the server) is a single string of key-value pairs, as follows:

{{{
op=LOGIN&pid=myid&password=mypw
}}}

In a Request, the parameter op has a special purpose: it specifies the name of the Request. Some examples of the op 's values are: LOGIN, LOGOUT, LIST, NEW, JOIN, RESIGN,... The complete list is described in the _Complete Reference_ session below.


= Complete Reference =

  * *LOGIN* - Log in the server
    * Request
      * Parameters:
        * _pid_ - The Player's ID
        * _password_ - The Player's password
        * _ctype_ - The optional client's type: "polling" is the only value supported.
{{{ 
op=LOGIN&pid=myid&password=mypw 
}}}
    * Response
      * To Player
        * op=LOGIN&code=0&content=playerid;score;sessionid
        * Example: op=LOGIN&code=0&content=myid;1398;312574
      * To others:
        * op=LOGIN&code=0&content=playerid;score
{{{
op=LOGIN&code=0&content=myid
}}}

  * *LOGOUT* - Log out the server
    * Request
    * Response

  * *LIST* - Get the list of Tables
  * *NEW* - Create a new Table
  * *JOIN* - Join an existing Table
  * *LEAVE* - Leave a Table
  * *UPDATE* - Update the Table's Rating/Non-Rating or Timers.
  * *MSG* - Post a _chat_ message to a Table
  * *PING* - Ping (keep-alive) the server to avoid being timed out.
  * *MOVE* - Make a new _Move_ in a Table
  * *RESIGN* - Resign the game at a Table
  * *DRAW* - Request to _draw_ the game at a Table
  * *RESET* - Reset (to _new_ status of the game) a Table 
  * *INVITE* - Invite a Player into a Table
  * *PLAYER_INFO* - Query for a Player's information
  * *POLL* - Poll for new events (specified used by _polling_ clients)

= Sample Session =

{{{
op=LOGIN&pid=myid&password=mypw
op=LOGIN&code=0&content=myid;1398;312574

op=LIST&pid=myid
op=LIST&code=0&content=1;0;0;1500/300/20;1500/300/20;1500/300/20;;0;AI_xqwlight;1575;

op=JOIN&color=None&joined=0&pid=myid&tid=1
op=I_TABLE&code=0&content=1;0;0;1500/300/20;1500/300/20;1500/300/20;;0;AI_xqwlight;1575;

op=JOIN&color=Red&joined=1&pid=myid&tid=1
op=E_JOIN&code=0&content=1;myid;1398;Red

op=MOVE&game_time=1500&move=6947&pid=myid&status=in_progress&tid=1
op=MOVE&code=0&content=1;AI_xqwlight;7062;in_progress

op=MOVE&game_time=1499&move=6665&pid=myid&status=in_progress&tid=1
op=MOVE&code=0&content=1;AI_xqwlight;2324;in_progress

op=MSG&msg=Bye, now&pid=myid&tid=1
op=MSG&msg=let us draw this game&pid=myid&tid=1
op=DRAW&draw_response=&pid=myid&tid=1
op=E_END&code=0&content=1;drawn;Players agree to draw

op=LEAVE&code=0&content=1;AI_xqwlight

op=LEAVE&pid=myid&tid=1
op=LEAVE&code=0&content=1;myid

op=NEW&itimes=1500/300/20&pid=myid
op=I_TABLE&code=0&content=1;0;0;1500/300/20;1500/300/20;1500/300/20;myid;1398;;0;

op=LEAVE&pid=myid&tid=1
op=LEAVE&code=0&content=1;myid

op=LOGOUT&pid=myid

}}}